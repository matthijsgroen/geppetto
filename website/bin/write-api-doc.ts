import { readFile, writeFile } from "fs/promises";
import { DocItem, methodSignature, objectAPI } from "./api-utils";

const INPUT_FILE = "docs/typedocs.json";
const OUTPUT_FILE = "docs/api.md";

const main = async () => {
  const fileContents = await readFile(INPUT_FILE, "utf8");
  const apiDoc = JSON.parse(fileContents) as DocItem;

  const template = `---
sidebar_position: 7
comment: "This file is automatically generated using \`yarn write-api-doc\`"
---

# API Reference

The api has a only a few methods to get you started:

- use [\`setupWebGL\`](#setupwebgl) or [\`createPlayer\`](#createplayer) to 
  initialize the canvas and get an [\`GeppettoPlayer\`](#geppettoplayer) object.
- use [\`prepareAnimation\`](#prepareanimation) to convert your animation to use with 
  [\`GeppettoPlayer.addAnimation\`](#geppettoplayer-addanimation).
- use the [\`AnimationControl\`](#animationcontrol) (as return of 
  [\`GeppettoPlayer.addAnimation\`](#geppettoplayer-addanimation)) to control your animation.

${methodSignature(apiDoc, "setupWebGL")}
${methodSignature(apiDoc, "createPlayer")}
${methodSignature(apiDoc, "prepareAnimation")}
${objectAPI(apiDoc, "GeppettoPlayer", ["AnimationControls"])}
${objectAPI(apiDoc, "AnimationControls")}
`;

  await writeFile(OUTPUT_FILE, template, "utf8");
};

main();
